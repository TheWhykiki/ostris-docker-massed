version: "3.8"

services:
  ai-toolkit:
    build:
      context: .
      args:
        # optional: anderer Branch/Commit/Tag
        AITOOLKIT_REF: "main"
        # optional: andere CUDA wheels
        TORCH_INDEX_URL: "https://download.pytorch.org/whl/cu126"
    image: ai-toolkit-local:latest
    restart: unless-stopped
    ports:
      - "8675:8675"
    environment:
      - AI_TOOLKIT_AUTH=${AI_TOOLKIT_AUTH:-password}
      - TZ=Europe/Berlin
    volumes:
      - ./datasets:/app/ai-toolkit/datasets
      - ./output:/app/ai-toolkit/output
      - ./config:/app/ai-toolkit/config
      - ./aitk_db.db:/app/ai-toolkit/aitk_db.db
      - ~/.cache/huggingface:/root/.cache/huggingface
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
